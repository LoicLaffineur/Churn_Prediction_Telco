# -*- coding: utf-8 -*-
"""Telco_app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1IM6jOsChCdNQkvmqC24q2VrOf2BhlLin
"""
import streamlit as st
import pandas as pd
import numpy as np
import joblib

# Load model and preprocessor
model = joblib.load("reg_log_model_churn.pkl")
scaler = joblib.load("scaler.pkl")
cols = joblib.load("features.pkl")  # List of features used in the model

# App title
st.title("üìâ Telco Customer Churn Prediction")
st.markdown("Pr√©disez si un client est √† risque de churn. Projet de data science - Portfolio")

# Sidebar form
st.sidebar.header("üßæ Informations client")
gender = st.sidebar.selectbox("Gender", ["Male", "Female"])
SeniorCitizen = st.sidebar.selectbox("Senior Citizen", [0, 1])
tenure = st.sidebar.slider("Tenure (mois)", 0, 72, 12)
MonthlyCharges = st.sidebar.number_input("Monthly Charges", 0.0, 200.0, 70.0)
TotalCharges = st.sidebar.number_input("Total Charges", 0.0, 10000.0, 1500.0)
Contract = st.sidebar.selectbox("Contract", ["Month-to-month", "One year", "Two year"])
InternetService = st.sidebar.selectbox("Internet Service", ["DSL", "Fiber optic", "No"])
PaperlessBilling = st.sidebar.selectbox("Paperless Billing", ["Yes", "No"])

# Convert to DataFrame
input_dict = {
    'gender': gender,
    'SeniorCitizen': SeniorCitizen,
    'tenure': tenure,
    'MonthlyCharges': MonthlyCharges,
    'TotalCharges': TotalCharges,
    'Contract': Contract,
    'InternetService': InternetService,
    'PaperlessBilling': PaperlessBilling
}
input_df = pd.DataFrame([input_dict])

num=['tenure', 'MonthlyCharges', 'TotalCharges']

# Preprocessing
input_encoded = pd.get_dummies(input_df)
input_encoded = input_encoded.reindex(columns=cols, fill_value=0)
input_scaled = input_encoded.copy()
input_scaled[num] = scaler.transform(input_encoded[num])

# Predict
proba = model.predict_proba(input_scaled)[0][1]
st.subheader("üéØ R√©sultat de la pr√©diction")
st.metric(label="Probabilit√© de churn", value=f"{proba*100:.2f} %")
if proba > 0.5:
    st.warning("‚ö†Ô∏è Ce client est √† **risque √©lev√©** de churn.")
else:
    st.success("‚úÖ Ce client est √† **faible risque** de churn.")

# Bonus (si tu veux aller plus loin)
# - Ajouter SHAP explainer ici
# - Visualiser top clients √† risque